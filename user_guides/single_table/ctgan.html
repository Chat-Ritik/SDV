
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CTGAN Model &#8212; SDV 0.17.0 documentation</title>
    
  <link rel="stylesheet" href="../../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sdv.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="shortcut icon" href="../../_static/SDV.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="CopulaGAN Model" href="copulagan.html" />
    <link rel="prev" title="GaussianCopula Model" href="gaussian_copula.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

    <a class="navbar-brand" href="../../index.html">
    
      <img src="../../_static/SDV.png" class="logo" alt="logo" />
    
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar-menu" class="col-lg-9 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">
        
        
        <li class="nav-item ">
            <a class="nav-link" href="../../getting_started/index.html">Getting Started</a>
        </li>
        
        <li class="nav-item active">
            <a class="nav-link" href="../index.html">User Guides</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../../api_reference/index.html">API Reference</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../../developer_guides/index.html">Developer Guides</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../../history.html">Release Notes</a>
        </li>
        
        
      </ul>


      

      <ul class="navbar-nav">
        
          <li class="nav-item">
            <a class="nav-link" href="https://github.com/sdv-dev/SDV" target="_blank" rel="noopener">
              <span><i class="fab fa-github-square"></i></span>
            </a>
          </li>
        
        
          <li class="nav-item">
            <a class="nav-link" href="https://twitter.com/sdv_dev" target="_blank" rel="noopener">
              <span><i class="fab fa-twitter-square"></i></span>
            </a>
          </li>
        
        
          <li class="nav-item">
            <a class="nav-link" href="https://bit.ly/sdv-slack-invite" target="_blank" rel="noopener">
              <img class="nav-icon-img" src="../../_static/slack-32.png">
            </a>
          </li>
        
      </ul>
    </div>
</div>

    </nav>
    

    <div class="container-xl">
      <div class="row">
          
          <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
    
    <ul class="nav bd-sidenav">
        
        
        
        
          
            
                <li class="active">
                    <a href="index.html">Single Table Data</a>
                    <ul>
                    
                        
                            <li class="">
                                <a href="data_description.html">Data Description</a>
                            </li>
                        

                    
                        
                            <li class="active">
                                <a href="models.html">Models</a>
                                <ul>
                                
                                    <li class="">
                                        <a href="tabular_preset.html">Tabular Preset</a>
                                    </li>
                                
                                    <li class="">
                                        <a href="gaussian_copula.html">GaussianCopula Model</a>
                                    </li>
                                
                                    <li class="active">
                                        <a href="">CTGAN Model</a>
                                    </li>
                                
                                    <li class="">
                                        <a href="copulagan.html">CopulaGAN Model</a>
                                    </li>
                                
                                    <li class="">
                                        <a href="tvae.html">TVAE Model</a>
                                    </li>
                                
                                </ul>
                            </li>
                        

                    
                        
                            <li class="">
                                <a href="constraints.html">Constraints</a>
                            </li>
                        

                    
                    </ul>
                </li>
            
          
            
                <li class="">
                    <a href="../relational/index.html">Relational Data</a>
                </li>
            
          
            
                <li class="">
                    <a href="../timeseries/index.html">Timeseries Data</a>
                </li>
            
          
            
                <li class="">
                    <a href="../evaluation/index.html">Synthetic Data Evaluation</a>
                </li>
            
          
            
                <li class="">
                    <a href="../benchmarking/index.html">Benchmarking Framework</a>
                </li>
            
          
        
        
        
        
        
        
        
        
      </ul>
  
  </nav>
          </div>
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#what-is-ctgan" class="nav-link">What is CTGAN?</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#quick-usage" class="nav-link">Quick Usage</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#generate-synthetic-data-from-the-model" class="nav-link">Generate synthetic data from the model</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#save-and-load-the-model" class="nav-link">Save and Load the model</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h4">
            <a href="#save-and-share-the-model" class="nav-link">Save and share the model</a>
        </li>
    
        <li class="nav-item toc-entry toc-h4">
            <a href="#load-the-model-and-generate-new-data" class="nav-link">Load the model and generate new data</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#specifying-the-primary-key-of-the-table" class="nav-link">Specifying the Primary Key of the table</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#anonymizing-personally-identifiable-information-pii" class="nav-link">Anonymizing Personally Identifiable Information (PII)</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#advanced-usage" class="nav-link">Advanced Usage</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#how-to-modify-the-ctgan-hyperparameters" class="nav-link">How to modify the CTGAN Hyperparameters?</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#conditional-sampling" class="nav-link">Conditional Sampling</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#how-do-i-specify-constraints" class="nav-link">How do I specify constraints?</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#can-i-evaluate-the-synthetic-data" class="nav-link">Can I evaluate the Synthetic Data?</a>
        </li>
    
            </ul>
        </li>
    
    </ul>
</nav>


              
          </div>
          

          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="ctgan-model">
<span id="ctgan"></span><h1>CTGAN Model<a class="headerlink" href="#ctgan-model" title="Permalink to this headline">¶</a></h1>
<p>In this guide we will go through a series of steps that will let you
discover functionalities of the <code class="docutils literal notranslate"><span class="pre">CTGAN</span></code> model, including how to:</p>
<ul class="simple">
<li><p>Create an instance of <code class="docutils literal notranslate"><span class="pre">CTGAN</span></code>.</p></li>
<li><p>Fit the instance to your data.</p></li>
<li><p>Generate synthetic versions of your data.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">CTGAN</span></code> to anonymize PII information.</p></li>
<li><p>Specify hyperparameters to improve the output quality.</p></li>
</ul>
<div class="section" id="what-is-ctgan">
<h2>What is CTGAN?<a class="headerlink" href="#what-is-ctgan" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">sdv.tabular.CTGAN</span></code> model is based on the GAN-based Deep Learning
data synthesizer which was presented at the NeurIPS 2020 conference by
the paper titled <a class="reference external" href="https://arxiv.org/abs/1907.00503">Modeling Tabular data using Conditional
GAN</a>.</p>
<p>Let’s now discover how to learn a dataset and later on generate
synthetic data with the same format and statistical properties by using
the <code class="docutils literal notranslate"><span class="pre">CTGAN</span></code> class from SDV.</p>
</div>
<div class="section" id="quick-usage">
<h2>Quick Usage<a class="headerlink" href="#quick-usage" title="Permalink to this headline">¶</a></h2>
<p>We will start by loading one of our demo datasets, the
<code class="docutils literal notranslate"><span class="pre">student_placements</span></code>, which contains information about MBA students
that applied for placements during the year 2020.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>In order to follow this guide you need to have <code class="docutils literal notranslate"><span class="pre">ctgan</span></code> installed on
your system. If you have not done it yet, please install <code class="docutils literal notranslate"><span class="pre">ctgan</span></code> now
by executing the command <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">sdv</span></code> in a terminal.</p>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="kn">from</span> <span class="nn">sdv.demo</span> <span class="kn">import</span> <span class="n">load_tabular_demo</span>

<span class="gp">In [2]: </span><span class="n">data</span> <span class="o">=</span> <span class="n">load_tabular_demo</span><span class="p">(</span><span class="s1">&#39;student_placements&#39;</span><span class="p">)</span>

<span class="gp">In [3]: </span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="gh">Out[3]: </span><span class="go"></span>
<span class="go">   student_id gender  second_perc  high_perc high_spec  degree_perc degree_type  work_experience  experience_years  employability_perc mba_spec  mba_perc   salary  placed start_date   end_date  duration</span>
<span class="go">0       17264      M        67.00      91.00  Commerce        58.00    Sci&amp;Tech            False                 0                55.0   Mkt&amp;HR     58.80  27000.0    True 2020-07-23 2020-10-12       3.0</span>
<span class="go">1       17265      M        79.33      78.33   Science        77.48    Sci&amp;Tech             True                 1                86.5  Mkt&amp;Fin     66.28  20000.0    True 2020-01-11 2020-04-09       3.0</span>
<span class="go">2       17266      M        65.00      68.00      Arts        64.00   Comm&amp;Mgmt            False                 0                75.0  Mkt&amp;Fin     57.80  25000.0    True 2020-01-26 2020-07-13       6.0</span>
<span class="go">3       17267      M        56.00      52.00   Science        52.00    Sci&amp;Tech            False                 0                66.0   Mkt&amp;HR     59.43      NaN   False        NaT        NaT       NaN</span>
<span class="go">4       17268      M        85.80      73.60  Commerce        73.30   Comm&amp;Mgmt            False                 0                96.8  Mkt&amp;Fin     55.50  42500.0    True 2020-07-04 2020-09-27       3.0</span>
</pre></div>
</div>
<p>As you can see, this table contains information about students which
includes, among other things:</p>
<ul class="simple">
<li><p>Their id and gender</p></li>
<li><p>Their grades and specializations</p></li>
<li><p>Their work experience</p></li>
<li><p>The salary that they were offered</p></li>
<li><p>The duration and dates of their placement</p></li>
</ul>
<p>You will notice that there is data with the following characteristics:</p>
<ul class="simple">
<li><p>There are float, integer, boolean, categorical and datetime values.</p></li>
<li><p>There are some variables that have missing data. In particular, all
the data related to the placement details is missing in the rows
where the student was not placed.</p></li>
</ul>
<p>Let us use <code class="docutils literal notranslate"><span class="pre">CTGAN</span></code> to learn this data and then sample synthetic data
about new students to see how well the model captures the characteristics
indicated above. In order to do this you will need to:</p>
<ul class="simple">
<li><p>Import the <code class="docutils literal notranslate"><span class="pre">sdv.tabular.CTGAN</span></code> class and create an instance of it.</p></li>
<li><p>Call its <code class="docutils literal notranslate"><span class="pre">fit</span></code> method passing our table.</p></li>
<li><p>Call its <code class="docutils literal notranslate"><span class="pre">sample</span></code> method indicating the number of synthetic rows
that you want to generate.</p></li>
</ul>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [4]: </span><span class="kn">from</span> <span class="nn">sdv.tabular</span> <span class="kn">import</span> <span class="n">CTGAN</span>

<span class="gp">In [5]: </span><span class="n">model</span> <span class="o">=</span> <span class="n">CTGAN</span><span class="p">()</span>

<span class="gp">In [6]: </span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Notice that the model <code class="docutils literal notranslate"><span class="pre">fitting</span></code> process took care of transforming the
different fields using the appropriate <a class="reference external" href="http://github.com/sdv-dev/RDT">Reversible Data
Transforms</a> to ensure that the data
has a format that the underlying CTGANSynthesizer class can handle.</p>
</div>
<div class="section" id="generate-synthetic-data-from-the-model">
<h3>Generate synthetic data from the model<a class="headerlink" href="#generate-synthetic-data-from-the-model" title="Permalink to this headline">¶</a></h3>
<p>Once the modeling has finished you are ready to generate new synthetic
data by calling the <code class="docutils literal notranslate"><span class="pre">sample</span></code> method from your model passing the number
of rows that we want to generate. The number of rows (<code class="docutils literal notranslate"><span class="pre">num_rows</span></code>)
is a required parameter.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [7]: </span><span class="n">new_data</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">num_rows</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
<p>This will return a table identical to the one which the model was fitted
on, but filled with new data which resembles the original one.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [8]: </span><span class="n">new_data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="gh">Out[8]: </span><span class="go"></span>
<span class="go">   student_id gender  second_perc  high_perc high_spec  degree_perc degree_type  work_experience  experience_years  employability_perc mba_spec  mba_perc   salary  placed                    start_date                      end_date  duration</span>
<span class="go">0       17478      M        70.64      88.25  Commerce        50.00   Comm&amp;Mgmt            False                 1               50.43  Mkt&amp;Fin     56.29  28454.0    True                           NaT 2020-05-15 07:51:44.590300160       NaN</span>
<span class="go">1       17362      M        65.51      63.56  Commerce        54.64      Others            False                 0               58.82  Mkt&amp;Fin     58.77  28246.0   False 2020-01-03 12:48:06.991664640                           NaT       4.0</span>
<span class="go">2       17400      F        56.55      56.88   Science        59.29   Comm&amp;Mgmt             True                 0               50.00   Mkt&amp;HR     51.25  25848.0    True                           NaT 2020-07-23 21:33:16.240367104       3.0</span>
<span class="go">3       17454      M        77.74      66.38  Commerce        72.68   Comm&amp;Mgmt            False                 0               62.27  Mkt&amp;Fin     63.79      NaN    True 2020-01-28 09:23:11.202473216 2020-07-09 23:54:12.886016000       4.0</span>
<span class="go">4       17383      F        67.62      50.77      Arts        70.84   Comm&amp;Mgmt            False                 0               50.43  Mkt&amp;Fin     57.06  26683.0    True 2020-03-18 19:32:59.044976384 2020-08-29 19:29:08.713674496       3.0</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There are a number of other parameters in this method that you can use to
optimize the process of generating synthetic data. Use <code class="docutils literal notranslate"><span class="pre">output_file_path</span></code>
to directly write results to a CSV file, <code class="docutils literal notranslate"><span class="pre">batch_size</span></code> to break up sampling
into smaller pieces &amp; track their progress and <code class="docutils literal notranslate"><span class="pre">randomize_samples</span></code> to
determine whether to generate the same synthetic data every time.
See the <a class="reference external" href="https://sdv.dev/SDV/api_reference/tabular/api/sdv.tabular.ctgan.CTGAN.sample">API section</a> for more details.</p>
</div>
</div>
<div class="section" id="save-and-load-the-model">
<h3>Save and Load the model<a class="headerlink" href="#save-and-load-the-model" title="Permalink to this headline">¶</a></h3>
<p>In many scenarios it will be convenient to generate synthetic versions
of your data directly in systems that do not have access to the original
data source. For example, if you may want to generate testing data on
the fly inside a testing environment that does not have access to your
production database. In these scenarios, fitting the model with real
data every time that you need to generate new data is feasible, so you
will need to fit a model in your production environment, save the fitted
model into a file, send this file to the testing environment and then
load it there to be able to <code class="docutils literal notranslate"><span class="pre">sample</span></code> from it.</p>
<p>Let’s see how this process works.</p>
<div class="section" id="save-and-share-the-model">
<h4>Save and share the model<a class="headerlink" href="#save-and-share-the-model" title="Permalink to this headline">¶</a></h4>
<p>Once you have fitted the model, all you need to do is call its <code class="docutils literal notranslate"><span class="pre">save</span></code>
method passing the name of the file in which you want to save the model.
Note that the extension of the filename is not relevant, but we will be
using the <code class="docutils literal notranslate"><span class="pre">.pkl</span></code> extension to highlight that the serialization
protocol used is
<a class="reference external" href="https://github.com/cloudpipe/cloudpickle">cloudpickle</a>.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [9]: </span><span class="n">model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;my_model.pkl&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This will have created a file called <code class="docutils literal notranslate"><span class="pre">my_model.pkl</span></code> in the same
directory in which you are running SDV.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>If you inspect the generated file you will notice that its size is much
smaller than the size of the data that you used to generate it. This is
because the serialized model contains <strong>no information about the
original data</strong>, other than the parameters it needs to generate
synthetic versions of it. This means that you can safely share this
<code class="docutils literal notranslate"><span class="pre">my_model.pkl</span></code> file without the risc of disclosing any of your real
data!</p>
</div>
</div>
<div class="section" id="load-the-model-and-generate-new-data">
<h4>Load the model and generate new data<a class="headerlink" href="#load-the-model-and-generate-new-data" title="Permalink to this headline">¶</a></h4>
<p>The file you just generated can be sent over to the system where the
synthetic data will be generated. Once it is there, you can load it
using the <code class="docutils literal notranslate"><span class="pre">CTGAN.load</span></code> method, and then you are ready to sample new
data from the loaded instance:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [10]: </span><span class="n">loaded</span> <span class="o">=</span> <span class="n">CTGAN</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;my_model.pkl&#39;</span><span class="p">)</span>

<span class="gp">In [11]: </span><span class="n">new_data</span> <span class="o">=</span> <span class="n">loaded</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">num_rows</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Notice that the system where the model is loaded needs to also have
<code class="docutils literal notranslate"><span class="pre">sdv</span></code> and <code class="docutils literal notranslate"><span class="pre">ctgan</span></code> installed, otherwise it will not be able to load
the model and use it.</p>
</div>
</div>
</div>
<div class="section" id="specifying-the-primary-key-of-the-table">
<h3>Specifying the Primary Key of the table<a class="headerlink" href="#specifying-the-primary-key-of-the-table" title="Permalink to this headline">¶</a></h3>
<p>One of the first things that you may have noticed when looking at the demo
data is that there is a <code class="docutils literal notranslate"><span class="pre">student_id</span></code> column which acts as the primary
key of the table, and which is supposed to have unique values. Indeed,
if we look at the number of times that each value appears, we see that
all of them appear at most once:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [12]: </span><span class="n">data</span><span class="o">.</span><span class="n">student_id</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="gh">Out[12]: </span><span class="go">1</span>
</pre></div>
</div>
<p>However, if we look at the synthetic data that we generated, we observe
that there are some values that appear more than once:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [13]: </span><span class="n">new_data</span><span class="p">[</span><span class="n">new_data</span><span class="o">.</span><span class="n">student_id</span> <span class="o">==</span> <span class="n">new_data</span><span class="o">.</span><span class="n">student_id</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="gh">Out[13]: </span><span class="go"></span>
<span class="go">     student_id gender  second_perc  high_perc high_spec  degree_perc degree_type  work_experience  experience_years  employability_perc mba_spec  mba_perc   salary  placed                    start_date                      end_date  duration</span>
<span class="go">0         17478      F        81.07      49.26   Science        66.60    Sci&amp;Tech             True                 0               53.72  Mkt&amp;Fin     56.11  28295.0    True 2020-01-31 02:13:29.261304576                           NaT       3.0</span>
<span class="go">3         17478      M        48.33      56.98  Commerce        50.00    Sci&amp;Tech            False                 1               50.00   Mkt&amp;HR     63.04      NaN    True 2020-03-31 00:17:00.202318848                           NaT       6.0</span>
<span class="go">8         17478      M        86.47      63.32      Arts        60.69    Sci&amp;Tech             True                 0               52.15  Mkt&amp;Fin     55.11  27216.0   False 2020-03-14 18:10:40.239526912                           NaT       6.0</span>
<span class="go">24        17478      M        48.60      37.00  Commerce        77.19   Comm&amp;Mgmt            False                 0               50.00  Mkt&amp;Fin     70.44  26604.0    True 2020-02-02 23:49:28.682610176 2020-05-14 09:30:11.331181056       4.0</span>
<span class="go">38        17478      M        49.79      46.22  Commerce        71.35   Comm&amp;Mgmt            False                 0               54.50   Mkt&amp;HR     57.04  28207.0   False 2020-08-09 13:50:34.367360512 2021-01-13 23:37:17.132436224       3.0</span>
<span class="go">49        17478      M        57.96      61.21  Commerce        54.56      Others            False                 0               51.11   Mkt&amp;HR     71.42  25015.0   False                           NaT 2020-09-13 22:10:23.538094336       NaN</span>
<span class="go">57        17478      M        81.82      57.42      Arts        78.65   Comm&amp;Mgmt             True                 0               59.22  Mkt&amp;Fin     52.42      NaN    True                           NaT 2020-06-05 06:53:44.028536320       NaN</span>
<span class="go">58        17478      F        66.10      68.69  Commerce        64.79   Comm&amp;Mgmt            False                 0               62.34   Mkt&amp;HR     70.63  27556.0   False 2020-04-03 12:49:57.587036416 2020-11-19 12:46:17.943703552       6.0</span>
<span class="go">60        17478      F        64.19      49.07   Science        52.76   Comm&amp;Mgmt             True                 0               73.69  Mkt&amp;Fin     64.98  20000.0    True 2020-09-23 07:19:37.328532480 2020-03-28 04:41:00.272476160       NaN</span>
<span class="go">67        17478      F        56.18      52.68   Science        65.59   Comm&amp;Mgmt            False                 0               57.00   Mkt&amp;HR     67.00  20000.0    True 2020-02-07 17:45:06.813538048 2020-03-19 07:44:26.064630016       NaN</span>
<span class="go">77        17478      F        66.32      89.13   Science        64.57   Comm&amp;Mgmt            False                 0               85.69   Mkt&amp;HR     61.61      NaN    True                           NaT                           NaT       NaN</span>
<span class="go">78        17478      F        43.69      56.75   Science        74.73   Comm&amp;Mgmt            False                 0               51.14  Mkt&amp;Fin     58.31  20758.0    True 2020-03-03 15:32:16.906571008 2020-08-28 14:19:20.203585280       3.0</span>
<span class="go">82        17478      F        54.34      82.48      Arts        57.77    Sci&amp;Tech            False                 0               74.25  Mkt&amp;Fin     68.73  26711.0    True 2020-03-08 02:59:17.364157440                           NaT       NaN</span>
<span class="go">85        17478      M        89.40      56.71  Commerce        65.76    Sci&amp;Tech            False                 0               64.59   Mkt&amp;HR     68.84      NaN    True 2020-03-17 02:24:14.238471936                           NaT       NaN</span>
<span class="go">88        17478      M        81.98      58.55  Commerce        74.43    Sci&amp;Tech            False                 1               50.00   Mkt&amp;HR     68.50  26887.0   False 2020-03-26 03:55:15.809023232                           NaT       3.0</span>
<span class="go">120       17478      M        69.25      44.90      Arts        91.00    Sci&amp;Tech            False                 0               89.51  Mkt&amp;Fin     63.85  40129.0    True 2020-07-28 22:30:41.299950080 2020-08-01 06:05:47.371391744       NaN</span>
<span class="go">131       17478      M        49.58      75.69   Science        53.67   Comm&amp;Mgmt            False                 0               66.08  Mkt&amp;Fin     67.77      NaN    True 2020-01-12 06:08:59.171041024 2020-06-27 12:11:21.289129984       6.0</span>
<span class="go">136       17478      F        65.28      56.86  Commerce        52.50      Others             True                 0               63.53   Mkt&amp;HR     66.95      NaN    True                           NaT                           NaT       5.0</span>
<span class="go">139       17478      M        42.48      61.68  Commerce        50.00   Comm&amp;Mgmt            False                 0               57.78  Mkt&amp;Fin     62.44  27317.0   False                           NaT                           NaT       NaN</span>
<span class="go">141       17478      M        81.54      57.45   Science        63.75    Sci&amp;Tech             True                 0               71.84   Mkt&amp;HR     63.68  23730.0    True 2020-03-19 04:14:48.220456448 2020-10-02 21:15:13.750016512       5.0</span>
<span class="go">161       17478      M        89.40      45.78      Arts        53.87      Others             True                 1               53.65  Mkt&amp;Fin     70.29      NaN    True                           NaT 2020-06-05 04:30:37.959530752       3.0</span>
<span class="go">163       17478      M        88.93      37.00   Science        58.99      Others            False                 0               60.28  Mkt&amp;Fin     68.87  28989.0    True                           NaT 2020-09-01 15:42:17.448461056       NaN</span>
<span class="go">165       17478      M        80.36      44.57   Science        57.12    Sci&amp;Tech             True                 0               80.82  Mkt&amp;Fin     64.63      NaN    True                           NaT                           NaT       NaN</span>
<span class="go">174       17478      F        53.99      54.71   Science        56.34    Sci&amp;Tech             True                 0               53.77   Mkt&amp;HR     71.42  25852.0    True                           NaT                           NaT       3.0</span>
<span class="go">188       17478      M        43.98      68.05  Commerce        65.03   Comm&amp;Mgmt            False                 1               60.49   Mkt&amp;HR     55.41  27473.0   False                           NaT 2020-12-21 09:12:50.678907648       NaN</span>
<span class="go">189       17478      F        40.89      55.50      Arts        65.03   Comm&amp;Mgmt             True                 0               50.00   Mkt&amp;HR     72.44      NaN   False                           NaT                           NaT       3.0</span>
<span class="go">190       17478      F        58.51      50.26  Commerce        86.65   Comm&amp;Mgmt            False                 1               84.21   Mkt&amp;HR     56.11      NaN   False 2020-03-22 12:11:15.058022912 2020-02-20 01:03:45.977135360       3.0</span>
<span class="go">195       17478      M        55.49      54.74  Commerce        71.32   Comm&amp;Mgmt             True                 0               50.00   Mkt&amp;HR     59.10      NaN    True 2020-01-27 10:55:53.260152832                           NaT       4.0</span>
<span class="go">199       17478      M        57.55      48.19   Science        51.38    Sci&amp;Tech            False                 0               50.00  Mkt&amp;Fin     61.84  20000.0    True                           NaT 2020-03-21 08:15:40.009521152       6.0</span>
</pre></div>
</div>
<p>This happens because the model was not notified at any point about the
fact that the <code class="docutils literal notranslate"><span class="pre">student_id</span></code> had to be unique, so when it generates new
data it will provoke collisions sooner or later. In order to solve this,
we can pass the argument <code class="docutils literal notranslate"><span class="pre">primary_key</span></code> to our model when we create it,
indicating the name of the column that is the index of the table.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [14]: </span><span class="n">model</span> <span class="o">=</span> <span class="n">CTGAN</span><span class="p">(</span>
<span class="gp">   ....: </span>    <span class="n">primary_key</span><span class="o">=</span><span class="s1">&#39;student_id&#39;</span>
<span class="gp">   ....: </span><span class="p">)</span>
<span class="gp">   ....: </span>

<span class="gp">In [15]: </span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="gp">In [16]: </span><span class="n">new_data</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>

<span class="gp">In [17]: </span><span class="n">new_data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="gh">Out[17]: </span><span class="go"></span>
<span class="go">   student_id gender  second_perc  high_perc high_spec  degree_perc degree_type  work_experience  experience_years  employability_perc mba_spec  mba_perc   salary  placed                    start_date                      end_date  duration</span>
<span class="go">0           0      M        59.19      80.49   Science        55.70   Comm&amp;Mgmt            False                 1               50.00  Mkt&amp;Fin     63.44  22257.0   False 2020-02-26 19:33:40.813119232 2020-04-01 14:24:28.728876288       NaN</span>
<span class="go">1           1      M        79.96      43.42  Commerce        51.34    Sci&amp;Tech            False                 0               69.80  Mkt&amp;Fin     62.59      NaN    True                           NaT 2020-04-24 14:10:30.504070656       NaN</span>
<span class="go">2           2      M        56.38      51.60      Arts        58.26   Comm&amp;Mgmt             True                 0               84.17   Mkt&amp;HR     60.66      NaN    True                           NaT 2020-12-22 18:19:40.277630208       NaN</span>
<span class="go">3           3      M        88.04      87.20  Commerce        50.00   Comm&amp;Mgmt             True                 0               84.25   Mkt&amp;HR     77.89      NaN    True 2020-01-20 23:12:00.658831104 2020-07-04 12:06:56.357483264      12.0</span>
<span class="go">4           4      F        66.30      50.97  Commerce        73.78    Sci&amp;Tech            False                 0               80.80   Mkt&amp;HR     71.31      NaN    True                           NaT 2020-08-02 15:21:50.451563008       NaN</span>
</pre></div>
</div>
<p>As a result, the model will learn that this column must be unique and
generate a unique sequence of values for the column:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [18]: </span><span class="n">new_data</span><span class="o">.</span><span class="n">student_id</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="gh">Out[18]: </span><span class="go">1</span>
</pre></div>
</div>
</div>
<div class="section" id="anonymizing-personally-identifiable-information-pii">
<h3>Anonymizing Personally Identifiable Information (PII)<a class="headerlink" href="#anonymizing-personally-identifiable-information-pii" title="Permalink to this headline">¶</a></h3>
<p>There will be many cases where the data will contain Personally
Identifiable Information which we cannot disclose. In these cases, we
will want our Tabular Models to replace the information within these
fields with fake, simulated data that looks similar to the real one but
does not contain any of the original values.</p>
<p>Let’s load a new dataset that contains a PII field, the
<code class="docutils literal notranslate"><span class="pre">student_placements_pii</span></code> demo, and try to generate synthetic versions
of it that do not contain any of the PII fields.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">student_placements_pii</span></code> dataset is a modified version of the
<code class="docutils literal notranslate"><span class="pre">student_placements</span></code> dataset with one new field, <code class="docutils literal notranslate"><span class="pre">address</span></code>, which
contains PII information about the students. Notice that this additional
<code class="docutils literal notranslate"><span class="pre">address</span></code> field has been simulated and does not correspond to data
from the real users.</p>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [19]: </span><span class="n">data_pii</span> <span class="o">=</span> <span class="n">load_tabular_demo</span><span class="p">(</span><span class="s1">&#39;student_placements_pii&#39;</span><span class="p">)</span>

<span class="gp">In [20]: </span><span class="n">data_pii</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="gh">Out[20]: </span><span class="go"></span>
<span class="go">   student_id                                            address gender  second_perc  high_perc high_spec  degree_perc degree_type  work_experience  experience_years  employability_perc mba_spec  mba_perc   salary  placed start_date   end_date  duration</span>
<span class="go">0       17264        70304 Baker Turnpike\nEricborough, MS 15086      M        67.00      91.00  Commerce        58.00    Sci&amp;Tech            False                 0                55.0   Mkt&amp;HR     58.80  27000.0    True 2020-07-23 2020-10-12       3.0</span>
<span class="go">1       17265    805 Herrera Avenue Apt. 134\nMaryview, NJ 36510      M        79.33      78.33   Science        77.48    Sci&amp;Tech             True                 1                86.5  Mkt&amp;Fin     66.28  20000.0    True 2020-01-11 2020-04-09       3.0</span>
<span class="go">2       17266        3702 Bradley Island\nNorth Victor, FL 12268      M        65.00      68.00      Arts        64.00   Comm&amp;Mgmt            False                 0                75.0  Mkt&amp;Fin     57.80  25000.0    True 2020-01-26 2020-07-13       6.0</span>
<span class="go">3       17267                   Unit 0879 Box 3878\nDPO AP 42663      M        56.00      52.00   Science        52.00    Sci&amp;Tech            False                 0                66.0   Mkt&amp;HR     59.43      NaN   False        NaT        NaT       NaN</span>
<span class="go">4       17268  96493 Kelly Canyon Apt. 145\nEast Steven, NC 3...      M        85.80      73.60  Commerce        73.30   Comm&amp;Mgmt            False                 0                96.8  Mkt&amp;Fin     55.50  42500.0    True 2020-07-04 2020-09-27       3.0</span>
</pre></div>
</div>
<p>If we use our tabular model on this new data we will see how the
synthetic data that it generates discloses the addresses from the real
students:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [21]: </span><span class="n">model</span> <span class="o">=</span> <span class="n">CTGAN</span><span class="p">(</span>
<span class="gp">   ....: </span>    <span class="n">primary_key</span><span class="o">=</span><span class="s1">&#39;student_id&#39;</span><span class="p">,</span>
<span class="gp">   ....: </span><span class="p">)</span>
<span class="gp">   ....: </span>

<span class="gp">In [22]: </span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data_pii</span><span class="p">)</span>

<span class="gp">In [23]: </span><span class="n">new_data_pii</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>

<span class="gp">In [24]: </span><span class="n">new_data_pii</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="gh">Out[24]: </span><span class="go"></span>
<span class="go">   student_id                                            address gender  second_perc  high_perc high_spec  degree_perc degree_type  work_experience  experience_years  employability_perc mba_spec  mba_perc   salary  placed                    start_date                      end_date  duration</span>
<span class="go">0           0  8303 Zachary Wells Apt. 628\nEast Melissatown,...      F        44.17      75.45      Arts        69.98    Sci&amp;Tech             True                 3               96.44  Mkt&amp;Fin     59.59      NaN   False 2020-08-04 14:41:58.263634176 2020-03-28 05:21:03.540186880      12.0</span>
<span class="go">1           1  4790 Travis Court Apt. 363\nWest Angelamouth, ...      F        54.88      49.71  Commerce        76.09    Sci&amp;Tech            False                 0               69.62   Mkt&amp;HR     69.86  29580.0    True                           NaT                           NaT      12.0</span>
<span class="go">2           2              5449 Evans Well\nPort Brett, DE 56274      F        46.02      58.05   Science        77.17   Comm&amp;Mgmt             True                 1               75.47   Mkt&amp;HR     75.79      NaN    True 2020-01-27 20:41:40.333192960 2020-11-08 21:10:41.005826816       NaN</span>
<span class="go">3           3                9596 Ross Rue\nMillerfurt, MS 36652      M        40.89      81.00   Science        73.11   Comm&amp;Mgmt             True                 0               57.14  Mkt&amp;Fin     77.45  27751.0    True                           NaT                           NaT       NaN</span>
<span class="go">4           4            8497 Steven Estate\nCindyberg, WV 01019      F        59.75      37.00  Commerce        80.15    Sci&amp;Tech            False                 0               93.96   Mkt&amp;HR     69.60      NaN   False 2020-02-18 18:50:15.653387776                           NaT       NaN</span>
</pre></div>
</div>
<p>More specifically, we can see how all the addresses that have been generated
actually come from the original dataset:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [25]: </span><span class="n">new_data_pii</span><span class="o">.</span><span class="n">address</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">data_pii</span><span class="o">.</span><span class="n">address</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="gh">Out[25]: </span><span class="go">200</span>
</pre></div>
</div>
<p>In order to solve this, we can pass an additional argument
<code class="docutils literal notranslate"><span class="pre">anonymize_fields</span></code> to our model when we create the instance. This
<code class="docutils literal notranslate"><span class="pre">anonymize_fields</span></code> argument will need to be a dictionary that
contains:</p>
<ul class="simple">
<li><p>The name of the field that we want to anonymize.</p></li>
<li><p>The category of the field that we want to use when we generate fake
values for it.</p></li>
</ul>
<p>The list complete list of possible categories can be seen in the <a class="reference external" href="https://faker.readthedocs.io/en/master/providers.html">Faker
Providers</a>
page, and it contains a huge list of concepts such as:</p>
<ul class="simple">
<li><p>name</p></li>
<li><p>address</p></li>
<li><p>country</p></li>
<li><p>city</p></li>
<li><p>ssn</p></li>
<li><p>credit_card_number</p></li>
<li><p>credit_card_expire</p></li>
<li><p>credit_card_security_code</p></li>
<li><p>email</p></li>
<li><p>telephone</p></li>
<li><p>…</p></li>
</ul>
<p>In this case, since the field is an address, we will pass a
dictionary indicating the category <code class="docutils literal notranslate"><span class="pre">address</span></code></p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [26]: </span><span class="n">model</span> <span class="o">=</span> <span class="n">CTGAN</span><span class="p">(</span>
<span class="gp">   ....: </span>    <span class="n">primary_key</span><span class="o">=</span><span class="s1">&#39;student_id&#39;</span><span class="p">,</span>
<span class="gp">   ....: </span>    <span class="n">anonymize_fields</span><span class="o">=</span><span class="p">{</span>
<span class="gp">   ....: </span>        <span class="s1">&#39;address&#39;</span><span class="p">:</span> <span class="s1">&#39;address&#39;</span>
<span class="gp">   ....: </span>    <span class="p">}</span>
<span class="gp">   ....: </span><span class="p">)</span>
<span class="gp">   ....: </span>

<span class="gp">In [27]: </span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data_pii</span><span class="p">)</span>
</pre></div>
</div>
<p>As a result, we can see how the real <code class="docutils literal notranslate"><span class="pre">address</span></code> values have been
replaced by other fake addresses:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [28]: </span><span class="n">new_data_pii</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>

<span class="gp">In [29]: </span><span class="n">new_data_pii</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="gh">Out[29]: </span><span class="go"></span>
<span class="go">   student_id                                            address gender  second_perc  high_perc high_spec  degree_perc degree_type  work_experience  experience_years  employability_perc mba_spec  mba_perc   salary  placed                    start_date                      end_date  duration</span>
<span class="go">0           0   9652 Neal Flat Suite 782\nSouth Cheryl, UT 22042      M        68.33      97.65      Arts        65.85   Comm&amp;Mgmt            False                 0               50.92   Mkt&amp;HR     76.59  26000.0    True 2020-01-25 02:41:55.572811008                           NaT       NaN</span>
<span class="go">1           1       89698 April Shoal\nNew Debbieville, NC 15039      M        72.02      83.76   Science        76.08   Comm&amp;Mgmt            False                 0               55.91   Mkt&amp;HR     62.39      NaN   False                           NaT 2020-06-26 03:31:19.191410176       6.0</span>
<span class="go">2           2   6685 Wanda Lodge Suite 451\nCarlosstad, MO 47089      M        53.02      67.40  Commerce        76.07    Sci&amp;Tech             True                 1               72.52   Mkt&amp;HR     76.20      NaN   False                           NaT 2020-10-05 05:13:58.471102720       NaN</span>
<span class="go">3           3        7546 Reed Green\nLake Samanthaton, MO 03493      M        73.20      88.94  Commerce        87.60   Comm&amp;Mgmt            False                 1               78.46  Mkt&amp;Fin     63.55      NaN    True 2020-01-18 22:06:24.537747712 2020-08-22 04:07:10.872238080       3.0</span>
<span class="go">4           4  812 Mosley Summit Suite 432\nPort Alexandra, P...      M        77.01      66.06  Commerce        64.06   Comm&amp;Mgmt            False                 0               93.07  Mkt&amp;Fin     77.89      NaN   False 2020-03-15 22:50:33.692546304                           NaT       7.0</span>
</pre></div>
</div>
<p>Which means that none of the original addresses can be found in the sampled
data:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [30]: </span><span class="n">data_pii</span><span class="o">.</span><span class="n">address</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">new_data_pii</span><span class="o">.</span><span class="n">address</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="gh">Out[30]: </span><span class="go">0</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="advanced-usage">
<h2>Advanced Usage<a class="headerlink" href="#advanced-usage" title="Permalink to this headline">¶</a></h2>
<p>Now that we have discovered the basics, let’s go over a few more
advanced usage examples and see the different arguments that we can pass
to our <code class="docutils literal notranslate"><span class="pre">CTGAN</span></code> Model in order to customize it to our needs.</p>
<div class="section" id="how-to-modify-the-ctgan-hyperparameters">
<h3>How to modify the CTGAN Hyperparameters?<a class="headerlink" href="#how-to-modify-the-ctgan-hyperparameters" title="Permalink to this headline">¶</a></h3>
<p>A part from the common Tabular Model arguments, <code class="docutils literal notranslate"><span class="pre">CTGAN</span></code> has a number
of additional hyperparameters that control its learning behavior and can
impact on the performance of the model, both in terms of quality of the
generated data and computational time.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">epochs</span></code> and <code class="docutils literal notranslate"><span class="pre">batch_size</span></code>: these arguments control the number of
iterations that the model will perform to optimize its parameters,
as well as the number of samples used in each step. Its default
values are <code class="docutils literal notranslate"><span class="pre">300</span></code> and <code class="docutils literal notranslate"><span class="pre">500</span></code> respectively, and <code class="docutils literal notranslate"><span class="pre">batch_size</span></code> needs
to always be a value which is multiple of <code class="docutils literal notranslate"><span class="pre">10</span></code>.</p>
<p>These hyperparameters have a very direct effect in time the training
process lasts but also on the performance of the data, so for new
datasets, you might want to start by setting a low value on both of
them to see how long the training process takes on your data and later
on increase the number to acceptable values in order to improve the
performance.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">log_frequency</span></code>: Whether to use log frequency of categorical levels
in conditional sampling. It defaults to <code class="docutils literal notranslate"><span class="pre">True</span></code>.
This argument affects how the model processes the frequencies of the
categorical values that are used to condition the rest of the values.
In some cases, changing it to <code class="docutils literal notranslate"><span class="pre">False</span></code> could lead to better performance.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">embedding_dim</span></code> (int): Size of the random sample passed to the
Generator. Defaults to 128.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">generator_dim</span></code> (tuple or list of ints): Size of the output samples for
each one of the Residuals. A Resiudal Layer will be created for each
one of the values provided. Defaults to (256, 256).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">discriminator_dim</span></code> (tuple or list of ints): Size of the output samples for
each one of the Discriminator Layers. A Linear Layer will be created
for each one of the values provided. Defaults to (256, 256).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">generator_lr</span></code> (float): Learning rate for the generator. Defaults to 2e-4.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">generator_decay</span></code> (float): Generator weight decay for the Adam Optimizer.
Defaults to 1e-6.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">discriminator_lr</span></code> (float): Learning rate for the discriminator.
Defaults to 2e-4.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">discriminator_decay</span></code> (float): Discriminator weight decay for the Adam
Optimizer. Defaults to 1e-6.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">discriminator_steps</span></code> (int): Number of discriminator updates to do for
each generator update. From the WGAN paper: <a class="reference external" href="https://arxiv.org/abs/1701.07875">https://arxiv.org/abs/1701.07875</a>.
WGAN paper default is 5. Default used is 1 to match original CTGAN
implementation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">verbose</span></code>: Whether to print fit progress on stdout. Defaults to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cuda</span></code> (bool or str): If <code class="docutils literal notranslate"><span class="pre">True</span></code>, use CUDA. If a <code class="docutils literal notranslate"><span class="pre">str</span></code>, use the
indicated device. If <code class="docutils literal notranslate"><span class="pre">False</span></code>, do not use cuda at all.</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Notice that the value that you set on the <code class="docutils literal notranslate"><span class="pre">batch_size</span></code> argument must always be a
multiple of <code class="docutils literal notranslate"><span class="pre">10</span></code>!</p>
</div>
<p>As an example, we will try to fit the <code class="docutils literal notranslate"><span class="pre">CTGAN</span></code> model slightly
increasing the number of epochs, reducing the <code class="docutils literal notranslate"><span class="pre">batch_size</span></code>, adding one
additional layer to the models involved and using a smaller wright
decay.</p>
<p>Before we start, we will evaluate the quality of the previously
generated data using the <code class="docutils literal notranslate"><span class="pre">sdv.evaluation.evaluate</span></code> function</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [31]: </span><span class="kn">from</span> <span class="nn">sdv.evaluation</span> <span class="kn">import</span> <span class="n">evaluate</span>

<span class="gp">In [32]: </span><span class="n">evaluate</span><span class="p">(</span><span class="n">new_data</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="gh">Out[32]: </span><span class="go">0.8145418319448716</span>
</pre></div>
</div>
<p>Afterwards, we create a new instance of the <code class="docutils literal notranslate"><span class="pre">CTGAN</span></code> model with the
hyperparameter values that we want to use</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [33]: </span><span class="n">model</span> <span class="o">=</span> <span class="n">CTGAN</span><span class="p">(</span>
<span class="gp">   ....: </span>    <span class="n">primary_key</span><span class="o">=</span><span class="s1">&#39;student_id&#39;</span><span class="p">,</span>
<span class="gp">   ....: </span>    <span class="n">epochs</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
<span class="gp">   ....: </span>    <span class="n">batch_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<span class="gp">   ....: </span>    <span class="n">generator_dim</span><span class="o">=</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">),</span>
<span class="gp">   ....: </span>    <span class="n">discriminator_dim</span><span class="o">=</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span>
<span class="gp">   ....: </span><span class="p">)</span>
<span class="gp">   ....: </span>
</pre></div>
</div>
<p>And fit to our data.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [34]: </span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, we are ready to generate new data and evaluate the results.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [35]: </span><span class="n">new_data</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

<span class="gp">In [36]: </span><span class="n">evaluate</span><span class="p">(</span><span class="n">new_data</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="gh">Out[36]: </span><span class="go">0.7341030362626308</span>
</pre></div>
</div>
<p>As we can see, in this case these modifications changed the obtained
results slightly, but they did neither introduce dramatic changes in the
performance.</p>
</div>
<div class="section" id="conditional-sampling">
<h3>Conditional Sampling<a class="headerlink" href="#conditional-sampling" title="Permalink to this headline">¶</a></h3>
<p>As the name implies, conditional sampling allows us to sample from a conditional
distribution using the <code class="docutils literal notranslate"><span class="pre">CTGAN</span></code> model, which means we can generate only values that
satisfy certain conditions. These conditional values can be passed to the <code class="docutils literal notranslate"><span class="pre">sample_conditions</span></code>
method as a list of <code class="docutils literal notranslate"><span class="pre">sdv.sampling.Condition</span></code> objects or to the <code class="docutils literal notranslate"><span class="pre">sample_remaining_columns</span></code>
method as a dataframe.</p>
<p>When specifying a <code class="docutils literal notranslate"><span class="pre">sdv.sampling.Condition</span></code> object, we can pass in the desired conditions
as a dictionary, as well as specify the number of desired rows for that condition.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [37]: </span><span class="kn">from</span> <span class="nn">sdv.sampling</span> <span class="kn">import</span> <span class="n">Condition</span>

<span class="gp">In [38]: </span><span class="n">condition</span> <span class="o">=</span> <span class="n">Condition</span><span class="p">({</span>
<span class="gp">   ....: </span>    <span class="s1">&#39;gender&#39;</span><span class="p">:</span> <span class="s1">&#39;M&#39;</span>
<span class="gp">   ....: </span><span class="p">},</span> <span class="n">num_rows</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="gp">   ....: </span>

<span class="gp">In [39]: </span><span class="n">model</span><span class="o">.</span><span class="n">sample_conditions</span><span class="p">(</span><span class="n">conditions</span><span class="o">=</span><span class="p">[</span><span class="n">condition</span><span class="p">])</span>
<span class="gh">Out[39]: </span><span class="go"></span>
<span class="go">   student_id gender  second_perc  high_perc high_spec  degree_perc degree_type  work_experience  experience_years  employability_perc mba_spec  mba_perc   salary  placed                    start_date                      end_date  duration</span>
<span class="go">0           0      M        89.40      56.02   Science        91.00   Comm&amp;Mgmt             True                 0               62.68  Mkt&amp;Fin     57.97  30536.0    True                           NaT 2020-06-26 11:23:04.570715392       3.0</span>
<span class="go">1           1      M        89.40      69.41   Science        91.00    Sci&amp;Tech             True                 0               54.36  Mkt&amp;Fin     71.29  41364.0    True 2020-08-12 18:03:11.851332352 2020-06-08 21:21:11.639626496       4.0</span>
<span class="go">2           2      M        89.40      50.94  Commerce        79.05   Comm&amp;Mgmt            False                 0               69.06   Mkt&amp;HR     61.77      NaN   False                           NaT                           NaT       NaN</span>
<span class="go">3           3      M        89.40      61.14   Science        79.83   Comm&amp;Mgmt            False                 0               50.00  Mkt&amp;Fin     69.83      NaN    True 2020-06-07 01:26:36.271735808 2020-06-30 17:18:03.359394560       4.0</span>
<span class="go">4           4      M        83.77      67.55   Science        76.48    Sci&amp;Tech            False                 0               76.64   Mkt&amp;HR     63.04      NaN    True                           NaT                           NaT       8.0</span>
</pre></div>
</div>
<p>It’s also possible to condition on multiple columns, such as
<code class="docutils literal notranslate"><span class="pre">gender</span> <span class="pre">=</span> <span class="pre">M,</span> <span class="pre">'experience_years':</span> <span class="pre">0</span></code>.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [40]: </span><span class="n">condition</span> <span class="o">=</span> <span class="n">Condition</span><span class="p">({</span>
<span class="gp">   ....: </span>    <span class="s1">&#39;gender&#39;</span><span class="p">:</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span>
<span class="gp">   ....: </span>    <span class="s1">&#39;experience_years&#39;</span><span class="p">:</span> <span class="mi">0</span>
<span class="gp">   ....: </span><span class="p">},</span> <span class="n">num_rows</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="gp">   ....: </span>

<span class="gp">In [41]: </span><span class="n">model</span><span class="o">.</span><span class="n">sample_conditions</span><span class="p">(</span><span class="n">conditions</span><span class="o">=</span><span class="p">[</span><span class="n">condition</span><span class="p">])</span>
<span class="gh">Out[41]: </span><span class="go"></span>
<span class="go">   student_id gender  second_perc  high_perc high_spec  degree_perc degree_type  work_experience  experience_years  employability_perc mba_spec  mba_perc   salary  placed                    start_date                      end_date  duration</span>
<span class="go">0           0      M        87.23      40.59  Commerce        79.45    Sci&amp;Tech            False                 0               53.94   Mkt&amp;HR     67.89      NaN   False                           NaT                           NaT       NaN</span>
<span class="go">1           1      M        89.40      37.00   Science        61.79   Comm&amp;Mgmt            False                 0               80.55   Mkt&amp;HR     54.92      NaN   False 2020-02-05 08:27:51.580749568 2020-08-16 21:29:17.907953408       NaN</span>
<span class="go">2           2      M        89.40      40.95  Commerce        91.00      Others            False                 0               96.43  Mkt&amp;Fin     59.95  58017.0    True 2020-06-16 16:04:16.727756288 2020-10-28 04:22:19.103537408      12.0</span>
<span class="go">3           3      M        83.10      53.66  Commerce        81.86    Sci&amp;Tech            False                 0               57.21  Mkt&amp;Fin     75.37      NaN   False                           NaT 2020-10-15 03:49:44.784283392       7.0</span>
<span class="go">4           4      M        59.87      37.00   Science        84.42   Comm&amp;Mgmt            False                 0               68.85   Mkt&amp;HR     58.21      NaN    True 2020-03-16 02:58:41.821491712                           NaT       NaN</span>
</pre></div>
</div>
<p>In the <code class="docutils literal notranslate"><span class="pre">sample_remaining_columns</span></code> method, <code class="docutils literal notranslate"><span class="pre">conditions</span></code> is
passed as a dataframe. In that case, the model
will generate one sample for each row of the dataframe, sorted in the same
order. Since the model already knows how many samples to generate, passing
it as a parameter is unnecessary. For example, if we want to generate three
samples where <code class="docutils literal notranslate"><span class="pre">gender</span> <span class="pre">=</span> <span class="pre">M</span></code> and three samples with <code class="docutils literal notranslate"><span class="pre">gender</span> <span class="pre">=</span> <span class="pre">F</span></code>, we can do the
following:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [42]: </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="gp">In [43]: </span><span class="n">conditions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
<span class="gp">   ....: </span>    <span class="s1">&#39;gender&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">],</span>
<span class="gp">   ....: </span><span class="p">})</span>
<span class="gp">   ....: </span>

<span class="gp">In [44]: </span><span class="n">model</span><span class="o">.</span><span class="n">sample_remaining_columns</span><span class="p">(</span><span class="n">conditions</span><span class="p">)</span>
<span class="gh">Out[44]: </span><span class="go"></span>
<span class="go">   student_id gender  second_perc  high_perc high_spec  degree_perc degree_type  work_experience  experience_years  employability_perc mba_spec  mba_perc   salary  placed                    start_date                      end_date  duration</span>
<span class="go">0           0      M        89.40      65.59   Science        91.00   Comm&amp;Mgmt             True                 0               59.95   Mkt&amp;HR     77.89  38831.0    True 2020-03-08 13:31:06.897436672 2020-09-13 19:15:54.723341824      12.0</span>
<span class="go">1           1      M        77.46      85.57   Science        74.75    Sci&amp;Tech            False                 0               83.80  Mkt&amp;Fin     62.28  28386.0    True 2020-03-10 02:09:32.975808000 2020-09-03 15:21:47.498969088       3.0</span>
<span class="go">2           2      M        89.40      62.52  Commerce        91.00   Comm&amp;Mgmt             True                 1               65.82  Mkt&amp;Fin     51.21  31627.0    True 2020-07-19 01:04:57.796350208 2020-04-21 09:14:49.532094464      12.0</span>
<span class="go">3           3      F        45.73      37.00  Commerce        50.70   Comm&amp;Mgmt            False                 0               54.88   Mkt&amp;HR     51.21      NaN   False                           NaT                           NaT       NaN</span>
<span class="go">4           4      F        80.24      66.80      Arts        66.28   Comm&amp;Mgmt            False                 0               63.84   Mkt&amp;HR     55.61  31659.0   False 2020-06-24 18:04:40.515021056 2020-03-21 04:19:00.944144640       5.0</span>
<span class="go">5           5      F        53.89      37.00   Science        64.01   Comm&amp;Mgmt            False                 0               50.00   Mkt&amp;HR     51.21      NaN   False                           NaT                           NaT       NaN</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">CTGAN</span></code> also supports conditioning on continuous values, as long as the values
are within the range of seen numbers. For example, if all the values of the
dataset are within 0 and 1, <code class="docutils literal notranslate"><span class="pre">CTGAN</span></code> will not be able to set this value to 1000.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [45]: </span><span class="n">condition</span> <span class="o">=</span> <span class="n">Condition</span><span class="p">({</span>
<span class="gp">   ....: </span>    <span class="s1">&#39;degree_perc&#39;</span><span class="p">:</span> <span class="mf">70.0</span>
<span class="gp">   ....: </span><span class="p">},</span> <span class="n">num_rows</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="gp">   ....: </span>

<span class="gp">In [46]: </span><span class="n">model</span><span class="o">.</span><span class="n">sample_conditions</span><span class="p">(</span><span class="n">conditions</span><span class="o">=</span><span class="p">[</span><span class="n">condition</span><span class="p">])</span>
<span class="gh">Out[46]: </span><span class="go"></span>
<span class="go">   student_id gender  second_perc  high_perc high_spec  degree_perc degree_type  work_experience  experience_years  employability_perc mba_spec  mba_perc   salary  placed                    start_date                      end_date  duration</span>
<span class="go">0           2      F        84.95      49.40  Commerce         70.0    Sci&amp;Tech            False                 0               55.61   Mkt&amp;HR     67.89  24695.0   False 2020-03-15 20:00:50.605285376 2020-08-09 22:40:06.019587328       NaN</span>
<span class="go">1          14      F        85.08      56.01  Commerce         70.0    Sci&amp;Tech            False                 0               98.00   Mkt&amp;HR     51.21  26447.0    True 2020-07-12 13:39:19.451109376 2020-09-15 16:54:29.867009792       3.0</span>
<span class="go">2          19      M        76.91      37.00   Science         70.0   Comm&amp;Mgmt            False                 0               53.68   Mkt&amp;HR     58.83      NaN   False                           NaT                           NaT       NaN</span>
<span class="go">3          28      M        78.17      51.86  Commerce         70.0   Comm&amp;Mgmt            False                 0               78.17   Mkt&amp;HR     59.54      NaN    True 2020-06-23 08:42:09.472262144                           NaT       NaN</span>
<span class="go">4           5      F        80.07      49.09  Commerce         70.0   Comm&amp;Mgmt            False                 0               84.19   Mkt&amp;HR     51.98  25891.0    True 2019-12-26 09:05:05.486151936 2020-11-07 02:02:05.680580864       3.0</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Conditional sampling works through a rejection sampling process, where
rows are sampled repeatedly until one that satisfies the conditions is found.
In case you are not able to sample enough valid rows, try increasing <code class="docutils literal notranslate"><span class="pre">max_tries_per_batch</span></code>.
More information about this parameter can be found in the <a class="reference external" href="https://sdv.dev/SDV/api_reference/tabular/api/sdv.tabular.ctgan.CTGAN.sample_conditions.html">API section</a></p>
<p>If you have many conditions that cannot easily be satisified, consider switching
to the <a class="reference external" href="https://sdv.dev/SDV/user_guides/single_table/gaussian_copula.html">GaussianCopula model</a>,
which is able to handle conditional sampling more efficiently.</p>
</div>
</div>
<div class="section" id="how-do-i-specify-constraints">
<h3>How do I specify constraints?<a class="headerlink" href="#how-do-i-specify-constraints" title="Permalink to this headline">¶</a></h3>
<p>If you look closely at the data you may notice that some properties were
not completely captured by the model. For example, you may have seen
that sometimes the model produces an <code class="docutils literal notranslate"><span class="pre">experience_years</span></code> number greater
than <code class="docutils literal notranslate"><span class="pre">0</span></code> while also indicating that <code class="docutils literal notranslate"><span class="pre">work_experience</span></code> is <code class="docutils literal notranslate"><span class="pre">False</span></code>.
These types of properties are what we call <code class="docutils literal notranslate"><span class="pre">Constraints</span></code> and can also
be handled using <code class="docutils literal notranslate"><span class="pre">SDV</span></code>. For further details about them please visit
the <a class="reference internal" href="constraints.html#single-table-constraints"><span class="std std-ref">Constraints</span></a> guide.</p>
</div>
<div class="section" id="can-i-evaluate-the-synthetic-data">
<h3>Can I evaluate the Synthetic Data?<a class="headerlink" href="#can-i-evaluate-the-synthetic-data" title="Permalink to this headline">¶</a></h3>
<p>A very common question when someone starts using <strong>SDV</strong> to generate
synthetic data is: <em>“How good is the data that I just generated?”</em></p>
<p>In order to answer this question, <strong>SDV</strong> has a collection of metrics
and tools that allow you to compare the <em>real</em> that you provided and the
<em>synthetic</em> data that you generated using <strong>SDV</strong> or any other tool.</p>
<p>You can read more about this in the <a class="reference internal" href="../evaluation/index.html#evaluation"><span class="std std-ref">Synthetic Data Evaluation</span></a> guide.</p>
</div>
</div>
</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                
    <a class='left-prev' id="prev-link" href="gaussian_copula.html" title="previous page">GaussianCopula Model</a>
    <a class='right-next' id="next-link" href="copulagan.html" title="next page">CopulaGAN Model</a>

              </div>
              
          </main>
          

      </div>
    </div>

    
  <script src="../../_static/js/index.d3f166471bb80abb5163.js"></script>


    
    <!-- Google Analytics -->
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-180602145-3', 'auto');
      ga('set', 'anonymizeIp', true);
      ga('send', 'pageview');
    </script>
    <script async src='https://www.google-analytics.com/analytics.js'></script>
    <!-- End Google Analytics -->
    <footer class="footer mt-5 mt-md-0">
  <div class="container">
    <p>
          &copy; Copyright 2018, MIT Data To AI Lab.<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.2.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>